
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Anexo: Ejercicios de XQuery &#8212; Apuntes de Lenguajes de Marcas v1.3</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="prev" title="Anexo: Ejercicios de XPath" href="../xpath/anexo_ejercicios_xpath.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="anexo-ejercicios-de-xquery">
<h1>Anexo: Ejercicios de XQuery<a class="headerlink" href="#anexo-ejercicios-de-xquery" title="Enlazar permanentemente con este título">¶</a></h1>
<p>En los ejercicios siguientes se asume que se va a utilizar la siguiente base de datos XML (tomada del libro de C.J. Date «Sistemas Gestores de Bases de Datos»)</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;datos&gt;</span>
    <span class="nt">&lt;proveedores&gt;</span>
        <span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreprov&gt;</span>Smith<span class="nt">&lt;/nombreprov&gt;</span>
            <span class="nt">&lt;estado&gt;</span>20<span class="nt">&lt;/estado&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proveedor&gt;</span>
        <span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreprov&gt;</span>Jones<span class="nt">&lt;/nombreprov&gt;</span>
            <span class="nt">&lt;estado&gt;</span>10<span class="nt">&lt;/estado&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proveedor&gt;</span>
        <span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v3&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreprov&gt;</span>Blake<span class="nt">&lt;/nombreprov&gt;</span>
            <span class="nt">&lt;estado&gt;</span>30<span class="nt">&lt;/estado&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proveedor&gt;</span>
        <span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v4&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreprov&gt;</span>Clarke<span class="nt">&lt;/nombreprov&gt;</span>
            <span class="nt">&lt;estado&gt;</span>20<span class="nt">&lt;/estado&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proveedor&gt;</span>
        <span class="nt">&lt;proveedor</span> <span class="na">numprov=</span><span class="s">&quot;v5&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreprov&gt;</span>Adams<span class="nt">&lt;/nombreprov&gt;</span>
            <span class="nt">&lt;estado&gt;</span>30<span class="nt">&lt;/estado&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Atenas<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proveedor&gt;</span>       
    <span class="nt">&lt;/proveedores&gt;</span>
    <span class="nt">&lt;partes&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Tuerca<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>12<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Perno<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Verde<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>17<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p3&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Tornillo<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Azul<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>17<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Roma<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p4&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Tornillo<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>14<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p5&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Leva<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Azul<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>12<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
        <span class="nt">&lt;parte</span> <span class="na">numparte=</span><span class="s">&quot;p6&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreparte&gt;</span>Engranaje<span class="nt">&lt;/nombreparte&gt;</span>
            <span class="nt">&lt;color&gt;</span>Rojo<span class="nt">&lt;/color&gt;</span>
            <span class="nt">&lt;peso&gt;</span>19<span class="nt">&lt;/peso&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/parte&gt;</span>
    <span class="nt">&lt;/partes&gt;</span>
    <span class="nt">&lt;proyectos&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y1&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>Clasificador<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Paris<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>Monitor<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Roma<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y3&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>OCR<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Atenas<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y4&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>Consola<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Atenas<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y5&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>RAID<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y6&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>EDS<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Oslo<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
        <span class="nt">&lt;proyecto</span> <span class="na">numproyecto=</span><span class="s">&quot;y7&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nombreproyecto&gt;</span>Cinta<span class="nt">&lt;/nombreproyecto&gt;</span>
            <span class="nt">&lt;ciudad&gt;</span>Londres<span class="nt">&lt;/ciudad&gt;</span>
        <span class="nt">&lt;/proyecto&gt;</span>
    <span class="nt">&lt;/proyectos&gt;</span>
    <span class="nt">&lt;suministros&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v1<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p1<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y1<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v1<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p1<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>700<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y1<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>400<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y3<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>300<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y5<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>600<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y6<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>400<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y7<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>600<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v2<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p5<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>100<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v3<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y1<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v3<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p4<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v4<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y3<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>300<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v4<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y7<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>300<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p2<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p2<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>100<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p5<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y5<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y2<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p1<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>100<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p3<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>200<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p4<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>800<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p5<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>400<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
        <span class="nt">&lt;suministra&gt;</span>
            <span class="nt">&lt;numprov&gt;</span>v5<span class="nt">&lt;/numprov&gt;</span>
            <span class="nt">&lt;numparte&gt;</span>p6<span class="nt">&lt;/numparte&gt;</span>
            <span class="nt">&lt;numproyecto&gt;</span>y4<span class="nt">&lt;/numproyecto&gt;</span>
            <span class="nt">&lt;cantidad&gt;</span>500<span class="nt">&lt;/cantidad&gt;</span>
        <span class="nt">&lt;/suministra&gt;</span>
    <span class="nt">&lt;/suministros&gt;</span>
<span class="nt">&lt;/datos&gt;</span>
</pre></div>
</div>
<p>A continuación se muestra la estructura en forma de tabla de los elementos XML de dicho archivo. Obsérvese que los atributos llevan la arroba delante y que no se han puesto todas las filas:</p>
<p>Tabla proveedores</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="20%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#64;numprov</th>
<th class="head">nombre</th>
<th class="head">estado</th>
<th class="head">ciudad</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>v1</td>
<td>Smith</td>
<td>20</td>
<td>Londres</td>
</tr>
<tr class="row-odd"><td>v2</td>
<td>Jones</td>
<td>10</td>
<td>Paris</td>
</tr>
</tbody>
</table>
<p>Tabla partes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="30%" />
<col width="16%" />
<col width="14%" />
<col width="18%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#64;numparte</th>
<th class="head">nombreparte</th>
<th class="head">color</th>
<th class="head">peso</th>
<th class="head">ciudad</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>p1</td>
<td>Tuerca</td>
<td>Rojo</td>
<td>12</td>
<td>Londres</td>
</tr>
<tr class="row-odd"><td>p2</td>
<td>Perno</td>
<td>Verde</td>
<td>17</td>
<td>Paris</td>
</tr>
</tbody>
</table>
<p>Tabla proyectos</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="40%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#64;numproyecto</th>
<th class="head">nombreproyecto</th>
<th class="head">ciudad</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>y1</td>
<td>Clasificador</td>
<td>Paris</td>
</tr>
<tr class="row-odd"><td>y2</td>
<td>Monitor</td>
<td>Roma</td>
</tr>
</tbody>
</table>
<p>Tabla suministra</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="24%" />
<col width="31%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">numprov</th>
<th class="head">numparte</th>
<th class="head">numproyecto</th>
<th class="head">cantidad</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>v1</td>
<td>p1</td>
<td>y1</td>
<td>200</td>
</tr>
<tr class="row-odd"><td>v1</td>
<td>p1</td>
<td>y4</td>
<td>700</td>
</tr>
</tbody>
</table>
<p>Obsérvese también que:</p>
<ul class="simple">
<li>En la tabla <code class="docutils literal"><span class="pre">suministra</span></code> el campo <code class="docutils literal"><span class="pre">numprov</span></code> es el mismo que el campo <code class="docutils literal"><span class="pre">numprov</span></code> de la tabla <code class="docutils literal"><span class="pre">proveedor</span></code></li>
<li>En la tabla <code class="docutils literal"><span class="pre">suministra</span></code> el campo <code class="docutils literal"><span class="pre">numparte</span></code> es el mismo que el campo <code class="docutils literal"><span class="pre">numparte</span></code> de la tabla <code class="docutils literal"><span class="pre">partes</span></code></li>
<li>En la tabla <code class="docutils literal"><span class="pre">suministra</span></code> el campo <code class="docutils literal"><span class="pre">numproyecto</span></code> es el mismo que el campo <code class="docutils literal"><span class="pre">numproyecto</span></code> de la tabla <code class="docutils literal"><span class="pre">proyectos</span></code></li>
</ul>
<div class="section" id="consulta-ciudad-de-los-proveedores">
<h2>Consulta: ciudad de los proveedores<a class="headerlink" href="#consulta-ciudad-de-los-proveedores" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Extraer la ciudad de los proveedores (no debe aparecer la etiqueta) que tengan un estado mayor de 15.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $proveedor in doc(&quot;datos.xml&quot;)/datos/proveedores/proveedor</span>
<span class="x">where $proveedor/estado &gt; 15</span>
<span class="x">return $proveedor/ciudad/text()</span>
</pre></div>
</div>
<p>Si se ejecuta esto se verá que el resultado es correcto sin embargo la presentación no es muy buena, al mostrarse todo seguido. Usemos por ejemplo la función <code class="docutils literal"><span class="pre">concat</span></code> para que cada resultado lleve un espacio detrás:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $proveedor in doc(&quot;datos.xml&quot;)/datos/proveedores/proveedor</span>
<span class="x">where $proveedor/estado &gt; 15</span>
<span class="x">return concat($proveedor/ciudad/text(), &#39; &#39;)</span>
</pre></div>
</div>
</div>
<div class="section" id="consulta-filas-de-la-tabla-partes">
<h2>Consulta: filas de la tabla partes<a class="headerlink" href="#consulta-filas-de-la-tabla-partes" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Averiguar cuantas partes existen, es decir, el total de filas de la «tabla» partes.</p>
<p>Para resolverlo una tentación muy común es resolverlo así:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $partes in doc(&quot;datos.xml&quot;)/datos/partes</span>
<span class="x">return count ($partes/parte)</span>
</pre></div>
</div>
<p>Y aunque esta solución funciona <strong>en realidad estamos haciendo un bucle de una sola iteración</strong>.</p>
<p>En este caso, se puede recurrir directamente a la función <code class="docutils literal"><span class="pre">count</span></code> que permite contar el número de elementos de una consulta parcial sin tener que hacer siquiera el recorrido.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">count (doc(&quot;datos.xml&quot;)/datos/partes/parte)</span>
</pre></div>
</div>
</div>
<div class="section" id="consulta-con-join-s">
<h2>Consulta con join’s<a class="headerlink" href="#consulta-con-join-s" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Obtener el nombre de los proyectos cuya ciudad sea Paris y que reciban una cantidad de partes &gt; 350</p>
</div>
<div class="section" id="paso-0-analisis">
<h2>Paso 0: análisis<a class="headerlink" href="#paso-0-analisis" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La cantidad está en las filas (elementos XML) <code class="docutils literal"><span class="pre">suministra</span></code> pero el <code class="docutils literal"><span class="pre">nombreproyecto</span></code> está en las filas <code class="docutils literal"><span class="pre">proyecto</span></code>. Será necesario «cruzar» elementos <code class="docutils literal"><span class="pre">proyecto</span></code> con elementos <code class="docutils literal"><span class="pre">suministra</span></code> usando como condición que <code class="docutils literal"><span class="pre">&#64;numproyecto</span></code> de los elementos <code class="docutils literal"><span class="pre">proyecto</span></code> sea igual a los campos <code class="docutils literal"><span class="pre">numproyecto</span></code> de los elementos <code class="docutils literal"><span class="pre">suministra</span></code></p>
</div>
<div class="section" id="paso-1-hacemos-el-cruce">
<h2>Paso 1: hacemos el cruce<a class="headerlink" href="#paso-1-hacemos-el-cruce" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Una primera aproximación sería esta:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $suministra in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">for $proyecto in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/proyectos/proyecto</span>
<span class="x">where $suministra/numproyecto = $proyecto/@numproyecto</span>

<span class="x">return $proyecto/nombreproyecto</span>
</pre></div>
</div>
<p>Sin embargo, esto devuelve «todos los proyectos» que de alguna manera aparezcan en la tabla <code class="docutils literal"><span class="pre">suministra</span></code></p>
</div>
<div class="section" id="paso-2-anadir-condiciones">
<h2>Paso 2: añadir condiciones<a class="headerlink" href="#paso-2-anadir-condiciones" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Nos han dicho que la cantidad de la tabla <code class="docutils literal"><span class="pre">suministra</span></code> debe ser mayor de 350, así que en el where o en el for de <code class="docutils literal"><span class="pre">suministra</span></code> podemos añadir una condición de filtrado:</p>
<p>Asimismo necesitamos solamente los proyectos cuyo campo <code class="docutils literal"><span class="pre">ciudad</span></code> sea Paris.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $suministra in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/suministros/suministra[cantidad&gt;350]</span>
<span class="x">for $proyecto in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/proyectos/proyecto[ciudad=&quot;Paris&quot;]</span>
<span class="x">where $suministra/numproyecto = $proyecto/@numproyecto</span>

<span class="x">return $proyecto/nombreproyecto</span>
</pre></div>
</div>
<p>Otra variante usando condiciones en el <code class="docutils literal"><span class="pre">where</span></code> sería esta:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $suministra in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">for $proyecto in</span>
<span class="x">  doc(&quot;datos.xml&quot;)/datos/proyectos/proyecto</span>
<span class="x">where $suministra/numproyecto = $proyecto/@numproyecto</span>
<span class="x">   and</span>
<span class="x">     $suministra/cantidad &gt; 350</span>
<span class="x">   and</span>
<span class="x">     $proyecto/ciudad=&quot;Paris&quot;</span>
<span class="x">return $proyecto/nombreproyecto</span>
</pre></div>
</div>
</div>
<div class="section" id="consulta-ciudades-iguales">
<h2>Consulta: ciudades iguales<a class="headerlink" href="#consulta-ciudades-iguales" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Obtener los nombres de proyecto y nombres de parte que estén en la misma ciudad.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $proyecto in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/proyectos/proyecto</span>
<span class="x">    for $parte in</span>
<span class="x">        doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">        where</span>
<span class="x">            $parte/ciudad = $proyecto/ciudad</span>
<span class="x">    return concat(</span>
<span class="x">        $parte/nombreparte, &quot; en la misma ciudad que &quot;,</span>
<span class="x">        $proyecto/nombreproyecto, &quot;-----&quot;</span>
<span class="x">    )</span>
</pre></div>
</div>
</div>
<div class="section" id="consulta-partes-con-colores-iguales">
<h2>Consulta: partes con colores iguales<a class="headerlink" href="#consulta-partes-con-colores-iguales" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Obtener parejas de partes que tengan el mismo color (indicando el nombre de ambas partes y el color que comparten)</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $p1 in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">for $p2 in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">    where</span>
<span class="x">        $p1/color = $p2/color</span>
<span class="x">    return concat ($p1/nombreparte,</span>
<span class="x">                   &quot; tiene el mismo color que &quot;,</span>
<span class="x">                   $p2/nombreparte,</span>
<span class="x">                   &quot; en concreto el color es:&quot;,</span>
<span class="x">                   $p1/color, &quot;</span>
<span class="x">                   &quot;)</span>
</pre></div>
</div>
<p>Esta consulta funciona, pero ofrece parejas de partes que no tienen mucho sentido en pantalla, por ejemplo «Tuerca es igual que Tuerca». Para mejorar la consulta, vamos a eliminar parejas en la cuales el <code class="docutils literal"><span class="pre">numparte</span></code> sea el mismo, es decir no vamos a contemplar el emparejar una parte consigo misma.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $p1 in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">for $p2 in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">where</span>
<span class="x">    $p1/color = $p2/color</span>
<span class="x">and</span>
<span class="x">    $p1/@numparte != $p2/@numparte</span>
<span class="x">return concat ($p1/nombreparte,</span>
<span class="x">                   &quot; tiene el mismo color que &quot;,</span>
<span class="x">                   $p2/nombreparte,</span>
<span class="x">                   &quot; en concreto el color es:&quot;,</span>
<span class="x">                   $p1/color, &quot;</span>
<span class="x">                   &quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="consulta-cantidad-de-partes-de-londres">
<h2>Consulta: cantidad de partes de Londres<a class="headerlink" href="#consulta-cantidad-de-partes-de-londres" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Averiguar cuantas partes existen cuya ciudad sea «Londres», es decir, el total de filas de la «tabla» partes pero teniendo en cuenta la condición de que el «campo» ciudad debe ser Londres.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">count (doc(&quot;datos.xml&quot;)/datos/partes/parte[ciudad=&#39;Londres&#39;])</span>
</pre></div>
</div>
</div>
<div class="section" id="consulta-media-de-partes-rojas">
<h2>Consulta: media de partes rojas<a class="headerlink" href="#consulta-media-de-partes-rojas" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Crear una consulta XQuery que averigüe la media de partes suministradas cuyo color sea “Rojo”</p>
<div class="section" id="paso-1-cruce-de-tablas">
<h3>Paso 1: cruce de tablas<a class="headerlink" href="#paso-1-cruce-de-tablas" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $parte in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">for $suministra in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">where</span>
<span class="x">    $parte/@numparte = $suministra/numparte</span>
<span class="x">//Faltaria el return</span>
</pre></div>
</div>
</div>
<div class="section" id="paso-2-anadir-condicion-de-filtrado">
<h3>Paso 2: añadir condicion de filtrado<a class="headerlink" href="#paso-2-anadir-condicion-de-filtrado" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $parte in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte</span>
<span class="x">for $suministra in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">where</span>
<span class="x">    $parte/@numparte = $suministra/numparte</span>
<span class="x">and</span>
<span class="x">    $parte/color=&#39;Rojo&#39;</span>
<span class="x">return $suministra/cantidad</span>
</pre></div>
</div>
<p>En realidad, este filtro también se podría hacer así:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $parte in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/partes/parte[color=&#39;Rojo&#39;]</span>
<span class="x">for $suministra in</span>
<span class="x">    doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">where</span>
<span class="x">    $parte/@numparte = $suministra/numparte</span>
<span class="x">return $suministra/cantidad</span>
</pre></div>
</div>
</div>
<div class="section" id="paso-3-calcular-la-media">
<h3>Paso 3: calcular la media<a class="headerlink" href="#paso-3-calcular-la-media" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">avg (</span>
<span class="x">    for $parte in</span>
<span class="x">        doc(&quot;datos.xml&quot;)/datos/partes/parte[color=&#39;Rojo&#39;]</span>
<span class="x">    for $suministra in</span>
<span class="x">        doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">    where</span>
<span class="x">        $parte/@numparte = $suministra/numparte</span>
<span class="x">    return $suministra/cantidad</span>
<span class="x">)</span>
</pre></div>
</div>
</div>
<div class="section" id="comprobacion">
<h3>Comprobación<a class="headerlink" href="#comprobacion" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Si analizamos la tabla partes veremos que las únicas partes cuyo color es “Rojo” son las partes <code class="docutils literal"><span class="pre">p1</span></code>, <code class="docutils literal"><span class="pre">p4</span></code> y <code class="docutils literal"><span class="pre">p6</span></code>.
Esto significa que las unicas filas de <code class="docutils literal"><span class="pre">suministra</span></code> que nos interesan son estas:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="24%" />
<col width="31%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">numprov</th>
<th class="head">numparte</th>
<th class="head">numproyecto</th>
<th class="head">cantidad</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>v1</td>
<td>p1</td>
<td>y1</td>
<td>200</td>
</tr>
<tr class="row-odd"><td>v1</td>
<td>p1</td>
<td>y4</td>
<td>700</td>
</tr>
<tr class="row-even"><td>v3</td>
<td>p4</td>
<td>y2</td>
<td>500</td>
</tr>
<tr class="row-odd"><td>v4</td>
<td>p6</td>
<td>y3</td>
<td>300</td>
</tr>
<tr class="row-even"><td>v4</td>
<td>p6</td>
<td>y7</td>
<td>300</td>
</tr>
<tr class="row-odd"><td>v5</td>
<td>p6</td>
<td>y2</td>
<td>200</td>
</tr>
<tr class="row-even"><td>v5</td>
<td>p1</td>
<td>y4</td>
<td>100</td>
</tr>
<tr class="row-odd"><td>v5</td>
<td>p4</td>
<td>y4</td>
<td>800</td>
</tr>
<tr class="row-even"><td>v5</td>
<td>p6</td>
<td>y4</td>
<td>500</td>
</tr>
</tbody>
</table>
<p>Como vemos hay 9 filas con suministros de partes cuyo color es “Rojo” y la suma de cantidades es 3600 por lo el resultado correcto es 400</p>
</div>
</div>
<div class="section" id="consulta-media-individual-de-partes-rojas">
<h2>Consulta: media individual de partes rojas<a class="headerlink" href="#consulta-media-individual-de-partes-rojas" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En el ejercicio anterior hemos calculado <em>la media global</em> de
partes rojas. Sin embargo, nos interesaría conocer la media de cada parte roja. Es decir, la media de p1, la media de p4 y la media de p6.</p>
<p>Extraigamos primero las partes cuyo color es rojo:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $parte in doc(&quot;datos.xml&quot;)/datos/partes/parte[color=&#39;Rojo&#39;]</span>
<span class="x">return $parte</span>
</pre></div>
</div>
<p>Si analizamos los resultados veremos que nos devuelve las partes p1, p4 y p6. Una vez hecho esto ahora devolvamos la media para cada una de esas partes:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $parte in doc(&quot;datos.xml&quot;)/datos/partes/parte[color=&#39;Rojo&#39;]</span>
<span class="x">return avg( doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">    [numparte=$parte/@numparte]/cantidad)</span>
</pre></div>
</div>
<p>Esta consulta nos muestra solo las cantidades de cada parte cuyo color es rojo. Vamos a mejorarla haciendo que aparezcan los
nombres de parte. Obsérvese que concatenamos las siguientes cosas:</p>
<ul class="simple">
<li>Primero el nombre de la parte.</li>
<li>Segundo un pequeño separador.</li>
<li>Despues la media (que se calcula solo para las filas de <code class="docutils literal"><span class="pre">suministra</span></code> cuyo <code class="docutils literal"><span class="pre">numparte</span></code> es igual que el atributo <code class="docutils literal"><span class="pre">numparte</span></code> de la parte que estamos analizando.)</li>
<li>Despues un espacio que separa unos resultados de otros</li>
</ul>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $parte in doc(&quot;datos.xml&quot;)/datos/partes/parte[color=&#39;Rojo&#39;]</span>
<span class="x">return concat (</span>
<span class="x">    $parte/nombreparte,</span>
<span class="x">    &quot;--&quot;,</span>
<span class="x">    avg (</span>
<span class="x">        doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">        [numparte=$parte/@numparte]/cantidad</span>
<span class="x">        ), &quot;          &quot; )</span>
</pre></div>
</div>
</div>
<div class="section" id="consulta-media-de-suministros">
<h2>Consulta: media de suministros<a class="headerlink" href="#consulta-media-de-suministros" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Averiguar la media de la cantidad de partes que aparecen en la «tabla» suministra</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">avg (doc(&quot;datos.xml&quot;)/datos/suministros/suministra/cantidad)</span>
</pre></div>
</div>
<p>Pregunta: ¿por qué no ponemos esta solución?</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">avg (doc(&quot;datos.xml&quot;)/datos/suministros/suministra/cantidad/text())</span>
</pre></div>
</div>
<p>Respuesta: las funciones son capaces de «extraer el texto automáticamente» si en el elemento no hay hijos. En este caso, la cantidad no tiene hijos, por lo que podemos ahorrarnos el <code class="docutils literal"><span class="pre">text()</span></code></p>
</div>
<div class="section" id="consulta-media-por-proveedor">
<h2>Consulta: media por proveedor<a class="headerlink" href="#consulta-media-por-proveedor" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Averiguar la media de cantidades por proveedor usando los datos de la tabla suministra.</p>
<p>Hagamos esta consulta por partes. En primer lugar, saquemos los distintos proveedores que hay en suministra</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $n in distinct-values(</span>
<span class="x">doc(&quot;datos.xml&quot;)/datos/</span>
<span class="x">proveedores/proveedor/@numprov)</span>
<span class="x">return $n</span>
</pre></div>
</div>
<p>Ahora, teniendo los distintos proveedores podemos devolver algo distinto de <code class="docutils literal"><span class="pre">numprov</span></code>. Podemos devolver la media para ese proveedor aprovechando los filtrados XPath.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $n in distinct-values(</span>
<span class="x">doc(&quot;datos.xml&quot;)/datos/</span>
<span class="x">proveedores/proveedor/@numprov)</span>
<span class="x">return avg</span>
<span class="x">( doc(&quot;datos.xml&quot;)/datos/suministros/suministra</span>
<span class="x">[numprov=$n]/cantidad)</span>
</pre></div>
</div>
<p>Y por último, si usamos <code class="docutils literal"><span class="pre">concat</span></code> apropiadamente podemos hacer que aparezca el número de proveedor al lado de dica cantidad.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $n in distinct-values(</span>
<span class="x">doc(&quot;datos.xml&quot;)/datos/proveedores/proveedor/@numprov)</span>
<span class="x">return concat (</span>
<span class="x"> $n, &#39; &#39;, avg(</span>
<span class="x"> doc(&quot;datos.xml&quot;)/datos/suministros</span>
<span class="x">/suministra[numprov=$n]/cantidad)</span>
<span class="x">)</span>
</pre></div>
</div>
</div>
<div class="section" id="consulta-suministros-en-grandes-cantidades">
<h2>Consulta: suministros en grandes cantidades<a class="headerlink" href="#consulta-suministros-en-grandes-cantidades" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Averiguar el nombre de los proyectos (sin que haya repeticiones) que reciban una cantidad en la tabla suministra mayor de 650.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">for $proyecto</span>
<span class="x">in doc(&quot;datos.xml&quot;)/datos/proyectos/proyecto</span>
<span class="x">for $suministra</span>
<span class="x">in</span>
<span class="x">doc(&quot;datos.xml&quot;)/datos/suministros/suministra[cantidad&gt;650]</span>
<span class="x">where $proyecto/@numproyecto = $suministra/numproyecto</span>
<span class="x">return ($proyecto/nombreproyecto, $suministra/cantidad)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Tabla de Contenidos</a></h3>
  <ul>
<li><a class="reference internal" href="#">Anexo: Ejercicios de XQuery</a><ul>
<li><a class="reference internal" href="#consulta-ciudad-de-los-proveedores">Consulta: ciudad de los proveedores</a></li>
<li><a class="reference internal" href="#consulta-filas-de-la-tabla-partes">Consulta: filas de la tabla partes</a></li>
<li><a class="reference internal" href="#consulta-con-join-s">Consulta con join’s</a></li>
<li><a class="reference internal" href="#paso-0-analisis">Paso 0: análisis</a></li>
<li><a class="reference internal" href="#paso-1-hacemos-el-cruce">Paso 1: hacemos el cruce</a></li>
<li><a class="reference internal" href="#paso-2-anadir-condiciones">Paso 2: añadir condiciones</a></li>
<li><a class="reference internal" href="#consulta-ciudades-iguales">Consulta: ciudades iguales</a></li>
<li><a class="reference internal" href="#consulta-partes-con-colores-iguales">Consulta: partes con colores iguales</a></li>
<li><a class="reference internal" href="#consulta-cantidad-de-partes-de-londres">Consulta: cantidad de partes de Londres</a></li>
<li><a class="reference internal" href="#consulta-media-de-partes-rojas">Consulta: media de partes rojas</a><ul>
<li><a class="reference internal" href="#paso-1-cruce-de-tablas">Paso 1: cruce de tablas</a></li>
<li><a class="reference internal" href="#paso-2-anadir-condicion-de-filtrado">Paso 2: añadir condicion de filtrado</a></li>
<li><a class="reference internal" href="#paso-3-calcular-la-media">Paso 3: calcular la media</a></li>
<li><a class="reference internal" href="#comprobacion">Comprobación</a></li>
</ul>
</li>
<li><a class="reference internal" href="#consulta-media-individual-de-partes-rojas">Consulta: media individual de partes rojas</a></li>
<li><a class="reference internal" href="#consulta-media-de-suministros">Consulta: media de suministros</a></li>
<li><a class="reference internal" href="#consulta-media-por-proveedor">Consulta: media por proveedor</a></li>
<li><a class="reference internal" href="#consulta-suministros-en-grandes-cantidades">Consulta: suministros en grandes cantidades</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../xpath/anexo_ejercicios_xpath.html" title="capítulo anterior">Anexo: Ejercicios de XPath</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Esta página</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ejercicios/xquery/anexo_ejercicios_xquery.rst.txt"
            rel="nofollow">Mostrar el código</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Búsqueda rápida</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Ir a" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Oscar Gomez.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../../_sources/ejercicios/xquery/anexo_ejercicios_xquery.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>